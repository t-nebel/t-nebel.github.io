<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Your personal Wayback Machine for your Microsoft Teams users"><title>Teams User History â€“ Who Had That Number? ğŸ“š</title><link rel=canonical href=https://blog.nebel.ruhr/p/teams-user-history/><link rel=stylesheet href=/scss/style.min.8b0cc90c77579409651f4c750fb8e56a4c9b607714e892bfc8a7d20c45c8c57d.css><meta property='og:title' content="Teams User History â€“ Who Had That Number? ğŸ“š"><meta property='og:description' content="Your personal Wayback Machine for your Microsoft Teams users"><meta property='og:url' content='https://blog.nebel.ruhr/p/teams-user-history/'><meta property='og:site_name' content='Through the Fog'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2025-09-01T10:00:00+00:00'><meta property='article:modified_time' content='2025-09-02T08:00:00+00:00'><meta property='og:image' content='https://blog.nebel.ruhr/p/teams-user-history/header.png'><meta name=twitter:title content="Teams User History â€“ Who Had That Number? ğŸ“š"><meta name=twitter:description content="Your personal Wayback Machine for your Microsoft Teams users"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.nebel.ruhr/p/teams-user-history/header.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.setItem(e,"dark")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_5c8d292399ad3270.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ’»</span></figure><div class=site-meta><h1 class=site-name><a href=/>Through the Fog</a></h1><h2 class=site-description>Scripts, thoughts and small projects around Microsoft Teams, AudioCodes SBCs and whatever else comes my way...</h2></div></header><ol class=menu-social><li><a href=https://github.com/t-nebel target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://de.linkedin.com/in/tobias-nebel-840463198 target=_blank title=LinkedIn rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 10-4 0"/><path d="M3 7a4 4 0 014-4h10a4 4 0 014 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about-me/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-lego"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9.5 11h.01"/><path d="M14.5 11h.01"/><path d="M9.5 15a3.5 3.5.0 005 0"/><path d="M7 5h1V3h8v2h1a3 3 0 013 3v9a3 3 0 01-3 3v1H7v-1a3 3 0 01-3-3V8a3 3 0 013-3"/></svg>
<span>About me</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archive</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/legal-imprint/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-section-sign"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9.172 19A3 3 0 1012 15"/><path d="M14.83 5A3 3 0 1012 9"/><path d="M12 12m-3 0a3 3 0 106 0 3 3 0 10-6 0"/></svg>
<span>Legal imprint</span></a></li><li class=menu-bottom-section><ol class=menu></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/teams-user-history/><img src=/p/teams-user-history/header_hu_f7b6612743215cbe.png srcset="/p/teams-user-history/header_hu_f7b6612743215cbe.png 800w, /p/teams-user-history/header_hu_a4de5e34f530c109.png 1600w" width=800 height=201 loading=lazy alt="Featured image of post Teams User History â€“ Who Had That Number? ğŸ“š"></a></div><div class=article-details><header class=article-category><a href=/categories/teams/ style=background-color:#6264a7;color:#fff>Microsoft Teams</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/teams-user-history/>Teams User History â€“ Who Had That Number? ğŸ“š</a></h2><h3 class=article-subtitle>Your personal Wayback Machine for your Microsoft Teams users</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 01, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><h2 id=the-mystery-of-the-missing-number>The Mystery of the Missing Number</h2><p>Ever played detective in your own Teams environment? One day, John Doe is reachable at his usual number, and the next, heâ€™s vanished into the digital ether. You start asking the usual questions:</p><ul><li>ğŸ“ What was John Doe&rsquo;s phone number before it was changed?</li><li>ğŸ”„ Did his Online Voice Routing Policy get switched?</li><li>ğŸ¤” And the million-dollar question: Who has his old number now?</li></ul><p>These are the everyday mysteries that Teams admins face. It often feels like you need a digital DeLorean to go back in time and see what happened.</p><h2 id=introducing-teams-user-history>Introducing: Teams User History</h2><p>What if you had a personal Wayback Machine for your Teams users? Thatâ€™s the idea behind the &ldquo;Teams User History&rdquo; project. Itâ€™s a simple, yet effective, way to keep track of user configurations over time.</p><p>The entire solution is built around a GitHub repository, which might sound a bit unusual at first. But when you think about it, itâ€™s the perfect fit:</p><ul><li>ğŸ“ <strong>Automatic Versioning</strong>: Every change is a commit. You get a complete, timestamped history of all data modifications for free.</li><li>ğŸ¤ <strong>Simple Collaboration</strong>: Need to share the data with a colleague? Just grant them access to the repo.</li><li>âš¡ <strong>Powerful Automation</strong>: GitHub Actions are used to automatically collect the data on a schedule. No more manual exports!</li><li>ğŸ” <strong>Secure Access</strong>: By using a Federated Credential, the data collection script authenticates against Microsoft Graph API without any secrets stored in the repository.</li></ul><h2 id=key-features->Key Features ğŸ¯</h2><h3 id=-phone-number-change-tracking>ğŸ“ Phone Number Change Tracking</h3><ul><li><strong>Complete number history</strong>: Track all phone number assignments and changes over time</li><li><strong>Deleted user handling</strong>: Smart detection and preservation of data when users are removed from the tenant</li><li><strong>Number reassignment visibility</strong>: See exactly when numbers move between users</li></ul><h3 id=-comprehensive-user-change-monitoring>ğŸ‘¥ Comprehensive User Change Monitoring</h3><ul><li><strong>Effective policy tracking</strong>: Leverages Teams PowerShell Effective Policy Assignments to capture all deviations from global defaults</li><li><strong>UPN change resilience</strong>: Tracks User Principal Name changes seamlessly by using UserID as the primary identifier in the background</li><li><strong>Complete configuration visibility</strong>: Monitor Voice Routing Policies, Dial Plans, Calling Policies, and more</li></ul><h3 id=-automated-housekeeping>ğŸ§¹ Automated Housekeeping</h3><ul><li><strong>Cleanup workflows</strong>: Built-in archive and cleanup workflows for efficient data management</li><li><strong>Retention policies</strong>: Configurable data retention to keep your repository size manageable</li><li><strong>Automated maintenance</strong>: Schedule regular housekeeping tasks to maintain optimal performance</li></ul><h3 id=-performance-optimizations>âš¡ Performance Optimizations</h3><ul><li><strong>Pre-loaded PowerShell modules</strong>: Teams PowerShell modules are cached and updated monthly via automated workflows for faster execution</li><li><strong>Optimized data collection</strong>: Efficient API calls and data processing to minimize runtime</li><li><strong>Incremental updates</strong>: Only captures and commits actual changes, reducing repository bloat</li></ul><h3 id=-on-demand-reporting>ğŸ“Š On-Demand Reporting</h3><ul><li><strong>GitHub Workflow integration</strong>: Simple, form-based report generation directly from the GitHub UI</li><li><strong>Summary visibility</strong>: All report results are displayed in the GitHub Actions summary for easy access</li><li><strong>Two report types</strong>: One for user history reports, and another for phone number tracking</li></ul><h2 id=how-it-works->How it Works âš™ï¸</h2><p>The project uses a PowerShell script, running on a scheduled GitHub Action, to fetch user details from your Microsoft tenant. It grabs key information like assigned phone numbers, Online Voice Routing Policies, and other user attributes, and stores them as JSON files in the repository.</p><p>For policy tracking and monitoring, the solution leverages the <a class=link href="https://learn.microsoft.com/en-us/powershell/module/microsoftteams/get-csonlineuser?view=teams-ps" target=_blank rel=noopener>Get-CsOnlineUser</a> cmdlet&rsquo;s <strong>EffectivePolicyAssignments</strong> output. This tracks effective policies regardless of whether they&rsquo;re assigned directly to users or through group assignments. The beauty of this approach is that it only shows entries when policies actually deviate from the global defaults, significantly reducing overhead and noise. If a policy is ever directly assigned to a user and later removed, that entry will appear in the effective policy assignments from that moment forward, ensuring Teams User History captures even these transitional states.</p><p>Because every change to these files is a new commit in the git history, you can easily check the history to see when changes happened and what a user&rsquo;s configuration looked like at any point in time.</p><h2 id=easy-reporting-with-github-workflows->Easy Reporting with GitHub Workflows ğŸš€</h2><p>To make this even more user-friendly, the project includes two simple GitHub workflows that you can trigger manually from the UI:</p><ol><li>ğŸ‘¤ <strong>Get User History by UPN</strong>: Just enter a User Principal Name (UPN), and the workflow will generate a report of that user&rsquo;s history.</li><li>ğŸ“ <strong>Get Number History</strong>: Enter a phone number, and the workflow will tell you which users have had that number assigned to them over time.</li></ol><p>Itâ€™s as simple as filling out a form and clicking a button.</p><h3 id=running-a-report>Running a Report</h3><p>To run a report, follow these simple steps:</p><ol><li>Navigate to the <strong>Actions</strong> tab in your GitHub repository.</li><li>Select the workflow you want to run from the list on the left.</li></ol><h4 id=-generate-user-report>ğŸ“ Generate User Report</h4><p>This workflow allows you to see the history of a specific user.</p><ol><li>Select the <strong>ğŸ“ Generate User Report</strong> workflow.</li><li>Click the <strong>Run workflow</strong> dropdown button.</li><li>Enter the <strong>User Principal Name (UPN)</strong> of the user you want to investigate.</li><li>Click the green <strong>Run workflow</strong> button.</li></ol><p><a href=userReport-AlEi.png target=_blank><img src=userReport-AlEi.png width=80% alt="Example of a user report showing historical changes for a specific user"></a></p><h4 id=-generate-phone-number-report>ğŸ“ Generate Phone Number Report</h4><p>This workflow helps you find out who has been assigned a specific phone number over time.</p><ol><li>Select the <strong>ğŸ“ Generate Phone Number Report</strong> workflow.</li><li>Click the <strong>Run workflow</strong> dropdown button.</li><li>Enter the <strong>Phone Number</strong> in E.164 format (e.g., <code>+1234567890</code>).</li><li>Click the green <strong>Run workflow</strong> button.</li></ol><p><a href=phoneReport.png target=_blank><img src=phoneReport.png width=80% alt="Example of a phone number report showing historical changes for a specific phone number"></a></p><p>This turns a potentially painful investigation into a two-minute task.</p><h2 id=get-started->Get Started ğŸ¯</h2><p>If you&rsquo;re tired of chasing ghosts in your Teams environment, head over to the GitHub repository to get started. The setup is straightforward, and the peace of mind is priceless. You can find the repository here: <a class=link href=https://github.com/t-nebel/teams-user-history target=_blank rel=noopener>Teams User History</a></p></section><footer class=article-footer><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Sep 02, 2025 08:00 CET</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/teams-dr-concurrent-calls-report/><div class=article-image><img src=/p/teams-dr-concurrent-calls-report/header.6e80a0f19f8ccf05258e137bba69d4d5_hu_9489d445889c331c.jpeg width=250 height=150 loading=lazy alt="Featured image of post Microsoft Teams Direct Routing - Get the concurrent call insights ğŸ“" data-key=teams-dr-concurrent-calls-report data-hash="md5-boCg8Z+MzwUljhN7umnU1Q=="></div><div class=article-details><h2 class=article-title>Microsoft Teams Direct Routing - Get the concurrent call insights ğŸ“</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 Through the Fog</section><section class=powerby>... all without guarantee - more like thoughts and inspiration ;)<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>