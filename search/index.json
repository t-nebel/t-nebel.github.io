[{"content":"The Mystery of the Missing Number Ever played detective in your own Teams environment? One day, John Doe is reachable at his usual number, and the next, he‚Äôs vanished into the digital ether. You start asking the usual questions:\nüìû What was John Doe\u0026rsquo;s phone number before it was changed? üîÑ Did his Online Voice Routing Policy get switched? ü§î And the million-dollar question: Who has his old number now? These are the everyday mysteries that Teams admins face. It often feels like you need a digital DeLorean to go back in time and see what happened.\nIntroducing: Teams User History What if you had a personal Wayback Machine for your Teams users? That‚Äôs the idea behind the \u0026ldquo;Teams User History\u0026rdquo; project. It‚Äôs a simple, yet effective, way to keep track of user configurations over time.\nThe entire solution is built around a GitHub repository, which might sound a bit unusual at first. But when you think about it, it‚Äôs the perfect fit:\nüìù Automatic Versioning: Every change is a commit. You get a complete, timestamped history of all data modifications for free. ü§ù Simple Collaboration: Need to share the data with a colleague? Just grant them access to the repo. ‚ö° Powerful Automation: GitHub Actions are used to automatically collect the data on a schedule. No more manual exports! üîê Secure Access: By using a Federated Credential, the data collection script authenticates against Microsoft Graph API without any secrets stored in the repository. Key Features üéØ üìû Phone Number Change Tracking Complete number history: Track all phone number assignments and changes over time Deleted user handling: Smart detection and preservation of data when users are removed from the tenant Number reassignment visibility: See exactly when numbers move between users üë• Comprehensive User Change Monitoring Effective policy tracking: Leverages Teams PowerShell Effective Policy Assignments to capture all deviations from global defaults UPN change resilience: Tracks User Principal Name changes seamlessly by using UserID as the primary identifier in the background Complete configuration visibility: Monitor Voice Routing Policies, Dial Plans, Calling Policies, and more üßπ Automated Housekeeping Cleanup workflows: Built-in archive and cleanup workflows for efficient data management Retention policies: Configurable data retention to keep your repository size manageable Automated maintenance: Schedule regular housekeeping tasks to maintain optimal performance ‚ö° Performance Optimizations Pre-loaded PowerShell modules: Teams PowerShell modules are cached and updated monthly via automated workflows for faster execution Optimized data collection: Efficient API calls and data processing to minimize runtime Incremental updates: Only captures and commits actual changes, reducing repository bloat üìä On-Demand Reporting GitHub Workflow integration: Simple, form-based report generation directly from the GitHub UI Summary visibility: All report results are displayed in the GitHub Actions summary for easy access Two report types: One for user history reports, and another for phone number tracking How it Works ‚öôÔ∏è The project uses a PowerShell script, running on a scheduled GitHub Action, to fetch user details from your Microsoft tenant. It grabs key information like assigned phone numbers, Online Voice Routing Policies, and other user attributes, and stores them as JSON files in the repository.\nFor policy tracking and monitoring, the solution leverages the Get-CsOnlineUser cmdlet\u0026rsquo;s EffectivePolicyAssignments output. This tracks effective policies regardless of whether they\u0026rsquo;re assigned directly to users or through group assignments. The beauty of this approach is that it only shows entries when policies actually deviate from the global defaults, significantly reducing overhead and noise. If a policy is ever directly assigned to a user and later removed, that entry will appear in the effective policy assignments from that moment forward, ensuring Teams User History captures even these transitional states.\nBecause every change to these files is a new commit in the git history, you can easily check the history to see when changes happened and what a user\u0026rsquo;s configuration looked like at any point in time.\nEasy Reporting with GitHub Workflows üöÄ To make this even more user-friendly, the project includes two simple GitHub workflows that you can trigger manually from the UI:\nüë§ Get User History by UPN: Just enter a User Principal Name (UPN), and the workflow will generate a report of that user\u0026rsquo;s history. üìû Get Number History: Enter a phone number, and the workflow will tell you which users have had that number assigned to them over time. It‚Äôs as simple as filling out a form and clicking a button.\nRunning a Report To run a report, follow these simple steps:\nNavigate to the Actions tab in your GitHub repository. Select the workflow you want to run from the list on the left. üìù Generate User Report This workflow allows you to see the history of a specific user.\nSelect the üìù Generate User Report workflow. Click the Run workflow dropdown button. Enter the User Principal Name (UPN) of the user you want to investigate. Click the green Run workflow button. üìû Generate Phone Number Report This workflow helps you find out who has been assigned a specific phone number over time.\nSelect the üìû Generate Phone Number Report workflow. Click the Run workflow dropdown button. Enter the Phone Number in E.164 format (e.g., +1234567890). Click the green Run workflow button. This turns a potentially painful investigation into a two-minute task.\nGet Started üéØ If you\u0026rsquo;re tired of chasing ghosts in your Teams environment, head over to the GitHub repository to get started. The setup is straightforward, and the peace of mind is priceless. You can find the repository here: Teams User History\n","date":"2025-09-01T10:00:00Z","image":"https://blog.nebel.ruhr/p/teams-user-history/header_hu_6447c7eb4cec9349.png","permalink":"https://blog.nebel.ruhr/p/teams-user-history/","title":"Teams User History ‚Äì Who Had That Number? üìö"},{"content":" üì¢ Update - Aug 22, 2025: This post has been updated with information about the new v2.0 release featuring enhanced name-based validation and improved reporting capabilities!\nThe Challenge with AudioCodes SBC Configurations If you‚Äôve worked with AudioCodes Session Border Controllers (SBCs), you know that comparing INI configuration files can be tricky. These files are packed with sections like IP Profiles, where endless strings of 0s and 1s which will make spotting differences feel like searching for needles in a haystack. Manual reviews sometimes miss subtle changes in parameters that could lead to issues in call handling. This is especially true when you have multiple SBCs in an \u0026ldquo;active-active-cluster\u0026rdquo; setup. The challenge is to quickly identify what‚Äôs changed, what‚Äôs missing, and what could potentially cause problems.\nPowerShell to the Rescue I‚Äôve developed a PowerShell script to simplify comparisons of AudioCodes SBC INI files. It parses the structured format, identifies variances in sections like IP-Profiles and generates a clean HTML report if there are differences.\nüõ†Ô∏è SBC-Focused compare:\nGeneral settings Table based settings like IP Profiles Drifted settings Missing Rows üìã HTML Report Features\nCustomizable displayname for each SBC Clear section-by-section comparison Highlighted differences for easy spotting Sample Output Here‚Äôs a screenshot of the HTML report generated by the script, showing differences between two SBC INI files (click to enlarge):\nGetting Started with the Script Clone or download from the repo. Launch PowerShell and move to the script folder. Compare with: 1 2 3 4 5 6 7 .\\Compare-ACSBCIniFiles.ps1 ` -SBCIniFilePath1 \u0026#34;C:\\Temp\\SBC1.ini\u0026#34; ` -SBCName1 \u0026#34;Old Config File\u0026#34; ` -SBCIniFilePath2 \u0026#34;C:\\Temp\\SBC2.ini\u0026#34; ` -SBCName2 \u0026#34;New Config File\u0026#34; ` -IncludeNameValidation $true ` -ReportFilePath \u0026#34;C:\\Temp\\SBC-Comparison.html\u0026#34; Open the generated HTML report in your browser. New Feature: Use -IncludeNameValidation $true to enable intelligent name-based comparison that matches table entries by their names even when index positions differ!\nGitHub Repository You can find the script in the GitHub repository: AudioCodes SBC INI File Comparison\nCurrent Limitations ‚úÖ RESOLVED! One current limitation is (at least for now üòâ) the handling of missmatching indexes but with the same content. For example, if both INI files have an IP Profile with the profile name \u0026ldquo;Teams\u0026rdquo; with the same settings, but on the first SBC it\u0026rsquo;s listed as index 0 and on the second SBC as index 1, the script could not match them correctly and will show them as different.\nUPDATE Aug 22,2025: This limitation has been completely resolved! The new -IncludeNameValidation parameter enables intelligent name-based comparison that automatically matches entries by their names, regardless of index position differences.\nüéâ What\u0026rsquo;s New in v2.0 (Aug 22,2025) Major Feature Enhancement: Name-Based Validation \u0026amp; Enhanced Reporting\nüîç Smart Name-Based Matching: New -IncludeNameValidation parameter automatically matches table entries by their names (e.g., IP Profile names) even when index positions differ ‚úÖ Visual Success Indicators: Console output now includes colored success indicators for matched entries with clear distinction between perfect matches and entries with differences üß† Intelligent Comparison Logic: Secondary name-based matching prevents false positives when identical content exists at different indices The script now handles complex scenarios where entries exist in both files but at different positions - exactly what AudioCodes SBC admins have been asking for!\n","date":"2025-07-18T22:10:00Z","image":"https://blog.nebel.ruhr/p/compare-ac-ini-files/header_hu_d97320df834500d7.jpg","permalink":"https://blog.nebel.ruhr/p/compare-ac-ini-files/","title":"Compare AudioCodes SBC INI Files üîé"},{"content":"The problem You\u0026rsquo;ve probably been asked this question before: \u0026ldquo;How many concurrent calls are we handling through our Microsoft Teams Direct Routing SBCs?\u0026rdquo;\nNormally Teams admins head straight to the Teams Admin Center, check those usage reports for their SBCs, and find hourly incoming and outgoing call counts. While helpful, this doesn\u0026rsquo;t answer the real question: How many calls were happening simultaneously?\nThis becomes even more challenging when you\u0026rsquo;re running multiple SBCs with load balancing - you need to piece together the total concurrent call picture across your entire SIP trunk infrastructure.\nA PowerShell Solution I needed better visibility into concurrent call patterns, so I built a PowerShell script that handles the calculations and data aggregation. The script includes an HTML dashboard (with some support from ü§ñ Copilot for the visual elements) that provides:\n‚úÖ Actual concurrent calls calculations ‚úÖ Cross-SBC aggregation for total infrastructure view ‚úÖ HTML dashboard for reporting ‚úÖ Dual data sources: Graph API or CSV exports ‚úÖ Business hours analysis for capacity planning ‚úÖ Weekly usage patterns and trend analysis GitHub Repository You can find the script and detailed instructions in the GitHub repository: Teams Direct Routing Concurrent Calls Analysis\nSample Output The generated HTML report will look like this:\nKey Features üîÑ Flexible Data Sources - Two options depending on your workflow:\nGraph API: Direct connection for automation with flexible date ranges App Secret or Certificate authentication modes CSV Import: Works with Teams Admin Center exports for ad-hoc analysis üìä Easy Analytics\nDaily concurrent call trends with visual charts Business hours averages (Monday-Friday, 8AM-6PM) 90th percentile capacity thresholds Weekly heatmaps showing peak usage times Top 10 highest traffic days for pattern analysis How to use this script Option 1: Graph API connection (flexible approach) Best for flexible reporting for example in context of the date range.\nPrerequisites Cause the Graph permission for that is only usable in the application context (and not your user context), you need an Azure App Registration with GraphAPI application permission CallRecords.Read.All\nAuthentication Examples App Secret Authentication:\n1 2 3 # Ensure you have the Microsoft.Graph module installed $AppSecret = Read-Host \u0026#34;Enter App Secret\u0026#34; -AsSecureString .\\ConcurrentCallsAnalysis.ps1 -DataSource GraphAPI -GraphConnectionMode AppSecret -AppId \u0026#34;your-app-id\u0026#34; -TenantId \u0026#34;your-tenant-id\u0026#34; -AppSecret $AppSecret Certificate Authentication:\n1 2 # Ensure you have the Microsoft.Graph module installed .\\ConcurrentCallsAnalysis.ps1 -DataSource GraphAPI -GraphConnectionMode Certificate -AppId \u0026#34;your-app-id\u0026#34; -TenantId \u0026#34;your-tenant-id\u0026#34; -CertificateThumbprint \u0026#34;cert-thumbprint\u0026#34; Date Range Options 1 2 3 4 5 # Last 30 days .\\ConcurrentCallsAnalysis.ps1 -DataSource GraphAPI -GraphConnectionMode AppSecret -AppId \u0026#34;...\u0026#34; -TenantId \u0026#34;...\u0026#34; -AppSecret $secret -startDate (Get-Date).AddDays(-30) # Specific period .\\ConcurrentCallsAnalysis.ps1 -DataSource GraphAPI -GraphConnectionMode AppSecret -AppId \u0026#34;...\u0026#34; -TenantId \u0026#34;...\u0026#34; -AppSecret $secret -startDate \u0026#34;2024-01-01\u0026#34; -endDate \u0026#34;2024-01-31\u0026#34; Option 2: CSV Import (Quick Analysis) Perfect for one-time analysis or when you prefer working with Teams Admin Center exports.\nStep 1: Export from Teams Admin Center Navigate to Teams Admin Center ‚Üí Analytics \u0026amp; reports ‚Üí Usage reports Select PSTN and SMS usage Choose Direct Routing tab Set your date range and export to Excel Save as CSV format Step 2: Run the Analysis 1 .\\ConcurrentCallsAnalysis.ps1 -DataSource CSV -CsvPath \u0026#34;C:\\Downloads\\DirectRoutingData.csv\u0026#34; Additional Options 1 2 3 4 5 # Specific SBCs only .\\ConcurrentCallsAnalysis.ps1 -DataSource CSV -CsvPath \u0026#34;data.csv\u0026#34; -sbcFQDNs @(\u0026#34;sbc1.domain.com\u0026#34;, \u0026#34;sbc2.domain.com\u0026#34;) # Custom output location .\\ConcurrentCallsAnalysis.ps1 -DataSource GraphAPI -GraphConnectionMode AppSecret ... -outputPath \u0026#34;C:\\Reports\\TeamsAnalysis.html\u0026#34; What You Get üìà Key Metrics Analysis Period: Days covered in the report Peak Daily Calls: Maximum concurrent call load Daily Average: Typical concurrent call volume Business Hours Average: Workday-specific metrics (Mon-Fri, 8AM-6PM) 90th Percentile: Capacity planning baseline High-Volume Days: Days exceeding normal patterns üìä Visual Analysis Daily Trends: Line charts with Monday markers for week-over-week comparison Weekly Heatmaps: Identify peak call times throughout the week Traffic Rankings: Sorted list of highest-volume days üîç Per-SBC Analysis For multi-SBC environments:\nIndividual SBC load patterns Capacity utilization comparison Load balancing effectiveness assessment Additional information In the README file of the repository, you will find more information regarding the script, including the prerequisites, how to create the Azure App Registration, and how to set up the required permissions.\n","date":"2025-06-13T00:00:00Z","image":"https://blog.nebel.ruhr/p/teams-dr-concurrent-calls-report/header_hu_54a27d4add8912e8.jpeg","permalink":"https://blog.nebel.ruhr/p/teams-dr-concurrent-calls-report/","title":"Microsoft Teams Direct Routing - Get the concurrent call insights üìû"},{"content":" 1 Write-Host \u0026#34;Hello World!\u0026#34; Welcome to the Blog - Through the Fog So here we go - in the future I plan to publish blog posts about (primarily) smaller PowerShell scripts/projects, Microsoft Teams Voice, AudioCodes SBCs and everything else that keeps me going.\n","date":"2025-05-21T00:00:00Z","image":"https://blog.nebel.ruhr/p/hello-world/header_hu_e116c06218742ee6.jpeg","permalink":"https://blog.nebel.ruhr/p/hello-world/","title":"Hello World"}]